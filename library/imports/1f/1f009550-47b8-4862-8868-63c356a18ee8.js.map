{"version":3,"sources":["..\\..\\..\\..\\assets\\script/assets\\script\\Enemy.js"],"names":["cc","Class","extends","Component","properties","enemyLaser","default","type","Node","speedX","speedY","downStep","onLoad","nodeCN","node","parent","on","reCalculateMargin","enemyDown","canvas","director","getScene","getChildByName","game","getComponent","lastShot","Date","now","waitMssTimePerShot","resetNumberTimesAllowedReachFinal","init","enemyPool","positionX","positionY","url","numberEnemies","sideMargin","horizontalEnemyMargin","verticalEnemyMargin","numberLines","self","speedXIncrease","baseIncreaseShootingByLevel","baseShooting","increaseShooting","goingDown","numberAliveEnemies","maxPosX","width","minPosX","minPosY","points","sprite","Sprite","loader","loadRes","SpriteFrame","err","spriteFrame","enabled","opacity","e","numberTimesAllowedReachFinal","getUserData","reEvaluateLeftMargin","reEvaluateRightMargin","reEvaluateBottomMargin","leftMost","i","length","j","rightMost","currentLevelY","isLeftMost","x","y","isRightMost","isLastBottom","bottom","allDead","onCollisionEnter","other","event","Event","EventCustom","dispatchEvent","setUserData","targetOff","destroy","createLaser","laser","instantiate","tempPos","position","active","zIndex","setSpeed","addChild","decidedToShoot","random0To1","update","dt","newPosY","goingDownStart","setPositionY","newPosX","setPositionX"],"mappings":"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","file":"unknown","sourceRoot":"..\\..\\..\\..\\assets\\script","sourcesContent":["cc.Class({\r\n  extends: cc.Component,\r\n\r\n  properties: {\r\n    enemyLaser: {\r\n        default: null,\r\n        type: cc.Node\r\n    },\r\n    speedX : 1,\r\n    speedY : 1,\r\n    downStep: 10\r\n  },\r\n\r\n  // use this for initialization\r\n  onLoad: function () {\r\n    var nodeCN = this.node.parent;\r\n    nodeCN.on('reEvaluateMargins', this.reCalculateMargin, this);\r\n    nodeCN.on('enemyDown', this.enemyDown, this);\r\n\r\n    this.canvas = cc.director.getScene().getChildByName('Canvas');\r\n    this.game = this.canvas.getComponent(\"Game\");\r\n    this.lastShot = Date.now();\r\n    this.waitMssTimePerShot = 4000;\r\n    this.resetNumberTimesAllowedReachFinal();\r\n  },\r\n\r\n\tinit: function (game,enemyPool,positionX,positionY,url,numberEnemies,sideMargin,horizontalEnemyMargin, verticalEnemyMargin,numberLines) {\r\n    var self = this;\r\n    // TO-DO levels\r\n    // TO-DO refactor\r\n    this.speedXIncrease = 0.04;\r\n    this.baseIncreaseShootingByLevel = 0.0002;\r\n    this.baseShooting = 0.01;\r\n    this.increaseShooting = 0;\r\n    this.goingDown = false;\r\n    this.enemyPool = enemyPool;\r\n    this.positionX = positionX;\r\n    this.positionY = positionY;\r\n    this.numberEnemies = numberEnemies;\r\n    this.numberAliveEnemies = numberEnemies * numberLines;\r\n    this.sideMargin = sideMargin;\r\n    this.horizontalEnemyMargin = horizontalEnemyMargin;\r\n    this.verticalEnemyMargin = verticalEnemyMargin;\r\n    this.maxPosX = this.node.parent.width/2 - this.sideMargin - ((numberEnemies - positionX -1) * horizontalEnemyMargin);\r\n    this.minPosX = -this.node.parent.width/2 + this.sideMargin + (positionX * horizontalEnemyMargin);\r\n    // TO-DO\r\n    this.minPosY = -250 + (verticalEnemyMargin * positionY);\r\n    this.points = 10 + (10 * positionY);\r\n\r\n    var sprite = this.node.getComponent(cc.Sprite);\r\n    cc.loader.loadRes(url, cc.SpriteFrame, function (err, spriteFrame) {\r\n      sprite.spriteFrame = spriteFrame;\r\n      self.positionX = positionX;\r\n      self.positionY = positionY;\r\n  \t\tself.game = game;\r\n  \t\tself.enabled = true;\r\n  \t\tself.node.opacity = 255;\r\n    });\r\n\t},\r\n\r\n  resetNumberTimesAllowedReachFinal: function(e)\r\n  {\r\n    this.numberTimesAllowedReachFinal = 6;\r\n  },\r\n\r\n  reCalculateMargin: function(e)\r\n  {\r\n    var type = e.getUserData();\r\n    switch (type){\r\n      case \"left\":\r\n        this.reEvaluateLeftMargin();\r\n        break;\r\n      case \"right\":\r\n        this.reEvaluateRightMargin();\r\n        break;\r\n      case \"bottom\":\r\n        this.reEvaluateBottomMargin();\r\n        break;\r\n    }\r\n\r\n  },\r\n\r\n  reEvaluateLeftMargin: function(e)\r\n  {\r\n    var leftMost = 0;\r\n    for (var i=1; i<this.enemyPool[0].length; i++)\r\n    {\r\n      for (var j=0; j<this.enemyPool.length; j++)\r\n      {\r\n        if (this.enemyPool[j][i] == 1)\r\n        {\r\n          leftMost = i;\r\n          break;\r\n        }\r\n      }\r\n      if (leftMost != 0)\r\n      {\r\n        break;\r\n      }\r\n    }\r\n    this.minPosX = -this.node.parent.width/2 + this.sideMargin + ((this.positionX - leftMost) * this.horizontalEnemyMargin);\r\n\r\n  },\r\n  reEvaluateRightMargin: function(e)\r\n  {\r\n    var rightMost = this.enemyPool[0].length;\r\n    for (var i=this.enemyPool[0].length-2; i>-1; i--)\r\n    {\r\n      for (var j=0; j<this.enemyPool.length; j++)\r\n      {\r\n        if (this.enemyPool[j][i] == 1)\r\n        {\r\n          rightMost = i;\r\n          break;\r\n        }\r\n      }\r\n      if (rightMost != this.enemyPool[0].length)\r\n      {\r\n        break;\r\n      }\r\n    }\r\n    this.maxPosX = this.node.parent.width/2 - this.sideMargin - (rightMost - this.positionX ) * this.horizontalEnemyMargin;\r\n\r\n  },\r\n  reEvaluateBottomMargin: function(e)\r\n  {\r\n    var currentLevelY = 0;\r\n    for (var j=0; j<this.positionY; j++)\r\n    {\r\n      for (var i=0; i<this.enemyPool[j].length; i++)\r\n      {\r\n        if (this.enemyPool[j][i] == 1)\r\n        {\r\n          currentLevelY++;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    this.minPosY = -250 + (this.verticalEnemyMargin * currentLevelY);\r\n  },\r\n\r\n  isLeftMost: function(x,y){\r\n    var leftMost = true;\r\n    for (var j=0; j<this.enemyPool.length; j++)\r\n    {\r\n      for (var i=0; i<x+1; i++)\r\n      {\r\n        leftMost = leftMost && !this.enemyPool[j][i];\r\n      }\r\n    }\r\n    return leftMost;\r\n  },\r\n\r\n  isRightMost: function(x,y){\r\n    var rightMost = true;\r\n    for (var j=this.enemyPool.length -1; j>-1; j--)\r\n    {\r\n      for (var i=this.enemyPool[y].length-1; i>x-1; i--)\r\n      {\r\n        rightMost = rightMost && !this.enemyPool[j][i];\r\n      }\r\n    }\r\n    return rightMost;\r\n  },\r\n  isLastBottom: function(x,y){\r\n    var bottom = true;\r\n    for (var j=0; j<y+1; j++)\r\n    {\r\n      for (var i=0; i<this.enemyPool[j].length; i++)\r\n      {\r\n        bottom = bottom && !this.enemyPool[j][i];\r\n      }\r\n    }\r\n      return bottom;\r\n  },\r\n\r\n  allDead: function(){\r\n    var allDead = true;\r\n    for (var j=0; j<this.enemyPool.length; j++)\r\n    {\r\n      for (var i=0; i<this.enemyPool[j].length; i++)\r\n      {\r\n        allDead = allDead && !this.enemyPool[j][i];\r\n        if (!allDead) return false;\r\n      }\r\n    }\r\n    return allDead;\r\n  },\r\n\r\n  onCollisionEnter: function (other, self) {\r\n    // TO-DO Explosion\r\n    // console.log(\" HIT ! \" + this.positionX + \",\"+this.positionY);\r\n    var event = new cc.Event.EventCustom(\"enemyDown\", true);\r\n    this.node.dispatchEvent(event);\r\n\r\n    this.enemyPool[this.positionY][this.positionX] = 0;\r\n    if (this.isLeftMost(this.positionX,this.positionY))\r\n    {\r\n      var event = new cc.Event.EventCustom(\"reEvaluateMargins\", true);\r\n      event.setUserData(\"left\");\r\n      this.node.dispatchEvent(event);\r\n    }\r\n    if (this.isRightMost(this.positionX,this.positionY))\r\n    {\r\n      var event = new cc.Event.EventCustom(\"reEvaluateMargins\", true);\r\n      event.setUserData(\"right\");\r\n      this.node.dispatchEvent(event);\r\n    }\r\n    if (this.isLastBottom(this.positionX,this.positionY))\r\n    {\r\n\r\n      this.resetNumberTimesAllowedReachFinal();\r\n      var event = new cc.Event.EventCustom(\"reEvaluateMargins\", true);\r\n      event.setUserData(\"bottom\");\r\n      this.node.dispatchEvent(event);\r\n    }\r\n\r\n    this.game.enemyDown({\"type\":\"standard\",\"points\":this.points});\r\n    var nodeCN = this.node.parent;\r\n    nodeCN.targetOff(this.node);\r\n    // nodeCN.off('reEvaluateMargins', this.reCalculateMargin, this);\r\n    // nodeCN.off('enemyDown', this.enemyDown, this);\r\n    this.node.destroy();\r\n  },\r\n\r\n  enemyDown: function ()\r\n  {\r\n    this.numberAliveEnemies -= 1;\r\n  },\r\n\r\n  createLaser: function ()\r\n  {\r\n    var laser = cc.instantiate(this.enemyLaser);\r\n    var tempPos = this.node.position;\r\n    tempPos.y -= 50;\r\n    laser.position = tempPos;\r\n    laser.active = true;\r\n    laser.zIndex = 1;\r\n    laser.getComponent(\"EnemyLaser\").setSpeed(150);\r\n    this.canvas.addChild(laser);\r\n    return true;\r\n  },\r\n\r\n  decidedToShoot: function ()\r\n  {\r\n    if ((Date.now() - this.lastShot) > this.waitMssTimePerShot)\r\n    {\r\n      return (cc.random0To1() < ((this.baseShooting + this.increaseShooting) / this.numberAliveEnemies));\r\n    }\r\n  },\r\n\r\n  update: function (dt) {\r\n    // TO-DO randomize\r\n    if (this.decidedToShoot())\r\n    {\r\n      this.createLaser(150);\r\n      this.lastShot = Date.now();\r\n    }\r\n\r\n    if (this.goingDown)\r\n    {\r\n      var newPosY = this.node.position.y - this.speedY;\r\n\r\n      /// TO-DO , si llega varias veces a este tope vertical, retirarlo y game over\r\n      //(newPosY > this.minPosY)\r\n\r\n      if ((this.numberTimesAllowedReachFinal!=0 || (newPosY > this.minPosY)) && (this.goingDownStart - newPosY < this.downStep))\r\n      {\r\n        this.node.setPositionY(newPosY)\r\n      }\r\n      else\r\n      {\r\n        if (newPosY <= this.minPosY)\r\n        {\r\n          this.numberTimesAllowedReachFinal--;\r\n        }\r\n        this.goingDown = false;\r\n      }\r\n    }\r\n    else\r\n    {\r\n      var newPosX = this.node.position.x + this.speedX;\r\n      // TO-DO si speed es demasiado grande no se mueve -> setear el máximo\r\n      if (newPosX > this.maxPosX || newPosX < this.minPosX)\r\n      {\r\n        this.increaseShooting += this.baseIncreaseShootingByLevel;\r\n\r\n        this.goingDown = true;\r\n        this.goingDownStart = this.node.position.y;\r\n        if (this.speedX > 0) this.speedX += this.speedXIncrease\r\n        else this.speedX -= this.speedXIncrease\r\n        this.speedX *=-1;\r\n      }\r\n      else\r\n      {\r\n        this.node.setPositionX(newPosX);\r\n      }\r\n    }\r\n  },\r\n\r\n});\r\n"]}